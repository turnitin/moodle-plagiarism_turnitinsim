{"version":3,"sources":["../src/cv_launch.js"],"names":["define","$","openCv","document","on","classList","parent","attr","split","submissionid","each","index","match","icon","M","cfg","wwwroot","cvWindow","window","open","write","body","html","ajax","type","url","dataType","data","action","sesskey","success","location","viewer_url","checkDVClosed","that","closed","setTimeout"],"mappings":"AA4BAA,OAAM,oCAAC,CAAC,QAAD,CAAD,CAAa,SAASC,CAAT,CAAY,CAC3B,MAAO,CACHC,MAAM,CAAE,iBAAW,CACfD,CAAC,CAACE,QAAD,CAAD,CAAYC,EAAZ,CAAe,OAAf,CAAwB,uBAAxB,CAAiD,UAAW,IAGpDC,CAAAA,CAAS,CAAGJ,CAAC,CAAC,IAAD,CAAD,CAAQK,MAAR,GAAiBC,IAAjB,CAAsB,OAAtB,EAA+BC,KAA/B,CAAqC,KAArC,CAHwC,CAIpDC,CAAY,CAAG,CAJqC,CAKxDR,CAAC,CAACI,CAAD,CAAD,CAAaK,IAAb,CAAkB,SAASC,CAAT,CAAgB,CAC9B,GAAIN,CAAS,CAACM,CAAD,CAAT,CAAiBC,KAAjB,CAAuB,cAAvB,CAAJ,CAA4C,CACxCH,CAAY,CAAGJ,CAAS,CAACM,CAAD,CAAT,CAAiBH,KAAjB,CAAuB,GAAvB,EAA4B,CAA5B,CAClB,CACJ,CAJD,EALwD,GAYpDK,CAAAA,CAAI,CAAGC,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,+CAZ6B,CAapDC,CAAQ,CAAGC,MAAM,CAACC,IAAP,EAbyC,CAexDF,CAAQ,CAACd,QAAT,CAAkBiB,KAAlB,CAAwB,iEACKN,CAAC,CAACC,GAAF,CAAMC,OADX,qDAAxB,EAEAC,CAAQ,CAACd,QAAT,CAAkBiB,KAAlB,CAAwB,gBAAxB,EAYAnB,CAAC,CAACgB,CAAQ,CAACd,QAAT,CAAkBkB,IAAnB,CAAD,CAA0BC,IAA1B,CAVc,wFAE6CT,CAF7C,+NAUd,EAEAZ,CAAC,CAACsB,IAAF,CAAO,CACHC,IAAI,CAAE,KADH,CAEHC,GAAG,CAAEX,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,qCAFlB,CAGHU,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAE,CACFC,MAAM,CAAE,mBADN,CAEFnB,YAAY,CAAEA,CAFZ,CAGFoB,OAAO,CAAEf,CAAC,CAACC,GAAF,CAAMc,OAHb,CAJH,CASHC,OAAO,CAAE,iBAASH,CAAT,CAAe,CAEpBV,CAAQ,CAACc,QAAT,CAAoBJ,CAAI,CAACK,UAAzB,CACA,KAAKC,aAAL,CAAmBhB,CAAnB,CACH,CAbE,CAcHgB,aAAa,CAAE,uBAAShB,CAAT,CAAmB,CAC9B,GAAIiB,CAAAA,CAAI,CAAG,IAAX,CACA,GAAIjB,CAAQ,CAACkB,MAAb,CAAqB,CACjBjB,MAAM,CAACa,QAAP,CAAkBb,MAAM,CAACa,QAAP,CAAkB,EACvC,CAFD,IAEO,CACHK,UAAU,CAAC,UAAW,CAClBF,CAAI,CAACD,aAAL,CAAmBhB,CAAnB,CACH,CAFS,CAEP,GAFO,CAGb,CACJ,CAvBE,CAAP,CAyBH,CAxDD,CAyDH,CA3DE,CA6DV,CA9DK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the Turnitin Cloud Viewer launch.\n *\n * @package   plagiarism_turnitinsim\n * @copyright 2017 Turnitin\n * @author    John McGettrick <jmcgettrick@turnitin.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module plagiarism_turnitinsim/cv_launch\n */\n\ndefine(['jquery'], function($) {\n    return {\n        openCv: function() {\n            $(document).on('click', '.turnitinsim_or_score', function() {\n\n                // Moodle forums strip ids from elements so we have to use classes.\n                var classList = $(this).parent().attr('class').split(/\\s+/);\n                var submissionid = 0;\n                $(classList).each(function(index) {\n                    if (classList[index].match(\"^submission_\")) {\n                        submissionid = classList[index].split(\"_\")[1];\n                    }\n                });\n\n                // Launch the Cloud Viewer in a new window.\n                var icon = M.cfg.wwwroot + '/plagiarism/turnitinsim/pix/turnitin-logo.png';\n                var cvWindow = window.open();\n\n                cvWindow.document.write('<html><head><link rel=\"stylesheet\" ' +\n                    'type=\"text/css\" href=\"'+M.cfg.wwwroot + '/plagiarism/turnitinsim/styles.css'+'\"></head><body>');\n                cvWindow.document.write('</body></html>');\n\n                var loading = '<div class=\"turnitinsim_Loading\">' +\n                        '<div>' +\n                            '<img class=\"turnitinsim_loadingLogo\" src=\"' + icon + '\">' +\n                        '</div>' +\n                        '<div class=\"turnitinsim_Loading_Circles\">' +\n                            '<span class=\"turnitinsim_Loading_Circle-1\"></span>' +\n                            '<span class=\"turnitinsim_Loading_Circle-2\"></span>' +\n                            '<span class=\"turnitinsim_Loading_Circle-3\"></span>' +\n                        '</div>' +\n                    '</div>';\n                $(cvWindow.document.body).html(loading);\n\n                $.ajax({\n                    type: \"GET\",\n                    url: M.cfg.wwwroot + \"/plagiarism/turnitinsim/ajax/cv.php\",\n                    dataType: \"json\",\n                    data: {\n                        action: 'request_cv_launch',\n                        submissionid: submissionid,\n                        sesskey: M.cfg.sesskey\n                    },\n                    success: function(data) {\n                        // Redirect opened window to returned URL.\n                        cvWindow.location = data.viewer_url;\n                        this.checkDVClosed(cvWindow);\n                    },\n                    checkDVClosed: function(cvWindow) {\n                        var that = this;\n                        if (cvWindow.closed) {\n                            window.location = window.location + '';\n                        } else {\n                            setTimeout(function() {\n                                that.checkDVClosed(cvWindow);\n                            }, 500);\n                        }\n                    }\n                });\n            });\n        }\n    };\n});"],"file":"cv_launch.min.js"}